<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>自动驾驶预测与决策规划（一） | Arvin</title><meta name="author" content="Arvin"><meta name="copyright" content="Arvin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="文档维护：Arvin 网页部署：Arvin ▶ 写在前面：本文内容是作者在深蓝学院自动驾驶预测与决策规划学习时的笔记，作者按照自己的理解进行了记录，如果有错误的地方还请执政。如涉侵权，请联系删除。 自动驾驶决策规划简介实验准备下载nuplan-devkit在终端中进入希望的安装目录，以主目录为例，运行代码拉取命令： 12cd ~git clone https:&#x2F;&#x2F;github.com&#x2F;motion">
<meta property="og:type" content="article">
<meta property="og:title" content="自动驾驶预测与决策规划（一）">
<meta property="og:url" content="http://example.com/2024/03/10/307-2024-03-10-Math-AutoDriver/index.html">
<meta property="og:site_name" content="Arvin">
<meta property="og:description" content="文档维护：Arvin 网页部署：Arvin ▶ 写在前面：本文内容是作者在深蓝学院自动驾驶预测与决策规划学习时的笔记，作者按照自己的理解进行了记录，如果有错误的地方还请执政。如涉侵权，请联系删除。 自动驾驶决策规划简介实验准备下载nuplan-devkit在终端中进入希望的安装目录，以主目录为例，运行代码拉取命令： 12cd ~git clone https:&#x2F;&#x2F;github.com&#x2F;motion">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/nacho.jepg">
<meta property="article:published_time" content="2024-03-09T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-19T08:41:33.647Z">
<meta property="article:author" content="Arvin">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/nacho.jepg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "自动驾驶预测与决策规划（一）",
  "url": "http://example.com/2024/03/10/307-2024-03-10-Math-AutoDriver/",
  "image": "http://example.com/img/nacho.jepg",
  "datePublished": "2024-03-09T16:00:00.000Z",
  "dateModified": "2025-08-19T08:41:33.647Z",
  "author": [
    {
      "@type": "Person",
      "name": "Arvin",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/nacho.jpeg"><link rel="canonical" href="http://example.com/2024/03/10/307-2024-03-10-Math-AutoDriver/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '自动驾驶预测与决策规划（一）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: None;"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Arvin</span></a><a class="nav-page-title" href="/"><span class="site-name">自动驾驶预测与决策规划（一）</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">自动驾驶预测与决策规划（一）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-03-09T16:00:00.000Z" title="Created 2024-03-10 00:00:00">2024-03-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-19T08:41:33.647Z" title="Updated 2025-08-19 16:41:33">2025-08-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>文档维护：<code>Arvin</code></p>
<p>网页部署：<code>Arvin</code></p>
<p>▶</p>
<p><strong>写在前面</strong>：本文内容是作者在深蓝学院<a target="_blank" rel="noopener" href="https://www.shenlanxueyuan.com/my/course/659">自动驾驶预测与决策规划</a>学习时的笔记，作者按照自己的理解进行了记录，如果有错误的地方还请执政。如涉侵权，请联系删除。</p>
<h1 id="自动驾驶决策规划简介"><a href="#自动驾驶决策规划简介" class="headerlink" title="自动驾驶决策规划简介"></a>自动驾驶决策规划简介</h1><h2 id="实验准备"><a href="#实验准备" class="headerlink" title="实验准备"></a>实验准备</h2><h3 id="下载nuplan-devkit"><a href="#下载nuplan-devkit" class="headerlink" title="下载nuplan-devkit"></a><strong>下载nuplan-devkit</strong></h3><p>在终端中进入希望的安装目录，以主目录为例，运行代码拉取命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">git clone https://github.com/motional/nuplan-devkit.git</span><br></pre></td></tr></table></figure>

<h3 id="安装miniconda"><a href="#安装miniconda" class="headerlink" title="安装miniconda"></a><strong>安装miniconda</strong></h3><p>在终端中输入以下命令下载miniconda安装包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br></pre></td></tr></table></figure>

<p>运行安装包，安装过程中按照指示一直按enter和选择yes即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash Miniconda3-latest-Linux-x86_64.sh</span><br></pre></td></tr></table></figure>

<p>conda全局初始化将conda的环境路径添加到用户目录的<code>.bashrc</code>文件中，终端每次启动时执行<code>.bashrc</code>添加conda的环境路径，初始化后重新启动终端即可使用conda命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/miniconda3/bin/conda init bash</span><br></pre></td></tr></table></figure>

<h4 id="conda换源"><a href="#conda换源" class="headerlink" title="conda换源"></a>conda换源</h4><p>装好conda后可以进行换源以提升速度：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">touch .condarc</span><br><span class="line">gedit .condarc</span><br><span class="line"></span><br><span class="line"># 复制如下内容到.condarc</span><br><span class="line">channels:</span><br><span class="line">  - defaults</span><br><span class="line">show_channel_urls: true</span><br><span class="line">default_channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2</span><br><span class="line">custom_channels:</span><br><span class="line">  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></pre></td></tr></table></figure>

<h4 id="创建conda环境"><a href="#创建conda环境" class="headerlink" title="创建conda环境"></a>创建conda环境</h4><p>重启终端，保证终端处于已经下载好的文件夹nuplan-devkit中，运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd nuplan-devkit</span><br><span class="line">conda create --name nuplan python=3.9</span><br><span class="line"></span><br><span class="line"># 启动conda环境</span><br><span class="line">conda activate nuplan</span><br><span class="line"></span><br><span class="line"># 安装指定版本pip</span><br><span class="line">python -m pip install pip==21.2.4 -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"></span><br><span class="line">## 关闭conda环境</span><br><span class="line"># conda deactivate</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="安装nuplan-devkit"><a href="#安装nuplan-devkit" class="headerlink" title="安装nuplan-devkit"></a><strong>安装nuplan-devkit</strong></h3><p>保证终端在nuplan-devkit目录下且nuplan的conda环境处于激活状态，运行以下命令，利用文件夹目录下的两个txt列表进行依赖包的安装，依赖包数量巨大，安装耗时长，可能出现中断现象。因此，在出现中断问题后应多次重复运行以上两行代码，保证所有包安装成功。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">conda activate nuplan </span><br><span class="line">cd nuplan-devkit</span><br><span class="line"></span><br><span class="line">pip install -r requirements_torch.txt</span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line">##  如果 torch==1.9.0+cu111 报错，则执行下述命令</span><br><span class="line"># pip install torch==1.9.0+cu111 -f https://download.pytorch.org/whl/cu111/torch_stable.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="下载nuplan数据集"><a href="#下载nuplan数据集" class="headerlink" title="下载nuplan数据集"></a><strong>下载nuplan数据集</strong></h3><p>在<a target="_blank" rel="noopener" href="https://www.nuscenes.org/nuplan">nuplan官网</a>注册后即可下载数据集：</p>
<p><img src="/./307-2024-03-10-Math-AutoDriver/1.png" alt="1"></p>
<p>注册后能进入如下下载界面，至少下载如图红框的两个数据集：<img src="/./307-2024-03-10-Math-AutoDriver/2.png" alt="2"></p>
<p>数据下载完成后，应分别解压到相应的文件夹，方便后续下载更大的训练数据集的数据集添加，  如果仅仅进行试用或者学习，我们不必下载trainval数据集，只需要下载maps和mini数据集。因此，在官方推荐文件层次结构的基础上可以进行相应简化，按如下格式存放下载好的maps和mini数据集即可：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~/nuplan</span><br><span class="line">└── dataset</span><br><span class="line">    ├── maps</span><br><span class="line">    │   ├── nuplan-maps-v1.0.json</span><br><span class="line">    │   ├── sg-one-north</span><br><span class="line">    │   │   └── 9.17.1964</span><br><span class="line">    │   │       └── map.gpkg</span><br><span class="line">    │   ├── us-ma-boston</span><br><span class="line">    │   │   └── 9.12.1817</span><br><span class="line">    │   │       └── map.gpkg</span><br><span class="line">    │   ├── us-nv-las-vegas-strip</span><br><span class="line">    │   │   └── 9.15.1915</span><br><span class="line">    │   │       └── map.gpkg</span><br><span class="line">    │   └── us-pa-pittsburgh-hazelwood</span><br><span class="line">    │       └── 9.17.1937</span><br><span class="line">    │           └── map.gpkg</span><br><span class="line">    └── nuplan-v1.1</span><br><span class="line">        └── splits</span><br><span class="line">              └── mini</span><br><span class="line">                   ├── 2021.05.12.22.00.38_veh-35_01008_01518.db</span><br><span class="line">                   ├── 2021.06.09.17.23.18_veh-38_00773_01140.db</span><br><span class="line">                   ├── ...</span><br><span class="line">                   └── 2021.10.11.08.31.07_veh-50_01750_01948.db</span><br></pre></td></tr></table></figure>

<h3 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h3><h4 id="软件包环境变量配置"><a href="#软件包环境变量配置" class="headerlink" title="软件包环境变量配置"></a>软件包环境变量配置</h4><p>为了运行nuplan-devkit源码，首先需要添加该环境变量，在<code>~/.bashrc</code>文件中根据nuplan-devkit的实际路径写入如下内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在.bashrc文件中写入</span></span><br><span class="line">export PYTHONPATH=&quot;$&#123;PYTHONPATH&#125;:$HOME/nuplan-devkit&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在终端中刷新环境变量</span></span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<h4 id="数据库环境变量配置"><a href="#数据库环境变量配置" class="headerlink" title="数据库环境变量配置"></a>数据库环境变量配置</h4><p>数据库环境变量配置的目的是方便通过代码快速找到数据文件夹的位置，同样需在<code>~/.bashrc</code>中添加以下路径根据数据集文件夹以及地图文件夹的位置进行设置：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在.bashrc文件中写入</span></span><br><span class="line"><span class="built_in">export</span> NUPLAN_DATA_ROOT=<span class="string">&quot;<span class="variable">$HOME</span>/nuplan/dataset&quot;</span></span><br><span class="line"><span class="built_in">export</span> NUPLAN_MAPS_ROOT=<span class="string">&quot;<span class="variable">$HOME</span>/nuplan/dataset/maps&quot;</span></span><br><span class="line"><span class="built_in">export</span> NUPLAN_DB_FILES=<span class="string">&quot;<span class="variable">$HOME</span>/nuplan/dataset/nuplan-v1.1/splits/mini&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在终端中刷新环境变量</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<h3 id="实验效果"><a href="#实验效果" class="headerlink" title="实验效果"></a>实验效果</h3><h4 id="场景可视化教程"><a href="#场景可视化教程" class="headerlink" title="场景可视化教程"></a>场景可视化教程</h4><p>终端进入<code>nuplan-devkit/tutorials</code>目录，运行jupyter notebook，进入网页选择<code>.ipynb</code>教程文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda activate nuplan</span><br><span class="line">cd nuplan-devkit/tutorials</span><br><span class="line">jupyter notebook</span><br></pre></td></tr></table></figure>

<p><img src="/./307-2024-03-10-Math-AutoDriver/3.png" alt="3"></p>
<p>双击<code>nuplan_scenario_visualization.ipynb</code>进入场景可视化教程，键盘按<code>shift+enter</code>运行，或点菜单栏<code>Run</code>中的<code>Run All Cells</code>选项：</p>
<p><img src="/./307-2024-03-10-Math-AutoDriver/4.png" alt="4"></p>
<p>选择场景，例如<code>changing_lane</code>：</p>
<p><img src="/307-2024-03-10-Math-AutoDriver/5.png" alt="5"></p>
<h4 id="开环测评教程"><a href="#开环测评教程" class="headerlink" title="开环测评教程"></a>开环测评教程</h4><p>开环测评是指回放所有车辆数据，计算开环分数，主要考量因素为预测轨迹和自车轨迹的位移偏差、航向角偏差等。<br> 在终端中输入如下指令，运行simple_planner的开环仿真程序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">conda activate nuplan</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> nuplan-devkit</span><br><span class="line"></span><br><span class="line">python nuplan/planning/script/run_simulation.py \</span><br><span class="line">+simulation=open_loop_boxes \</span><br><span class="line">planner=simple_planner \</span><br><span class="line">scenario_builder=nuplan_mini \</span><br><span class="line">scenario_filter=all_scenarios \</span><br><span class="line">scenario_filter.scenario_types=<span class="string">&quot;[near_multiple_vehicles, on_pickup_dropoff, starting_unprotected_cross_turn, high_magnitude_jerk]&quot;</span> \</span><br><span class="line">scenario_filter.num_scenarios_per_type=10</span><br></pre></td></tr></table></figure>

<p>在终端中输入如下指令，运行nuboard程序，跳转到浏览器：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python nuplan/planning/script/run_nuboard.py</span><br></pre></td></tr></table></figure>

<p>在浏览器中，点击<code>Upload file</code>，选择<code>~/nuplan/exp/exp/simulation/open_loop_boxes/xxxx</code>路径下的<code>nuboard_xxxx.nuboard</code>文件，在网页的Oerview界面中查看开环测评的结果：</p>
<p><img src="/307-2024-03-10-Math-AutoDriver/6.png" alt="6"></p>
<p>在网页的Scenarios界面中查看开环测评的场景信息（点击右上角设置图标选择场景）：</p>
<p><img src="/307-2024-03-10-Math-AutoDriver/7.png" alt="7"></p>
<h4 id="无响应闭环测评教程"><a href="#无响应闭环测评教程" class="headerlink" title="无响应闭环测评教程"></a>无响应闭环测评教程</h4><p>闭环测评是指自车运行在仿真环境，根据社会车辆是否对自车运动有反应分为：无响应闭环和有响应闭环。</p>
<p>无响应闭环是指社会车辆对自车运动无响应，在终端中输入如下指令，运行simple_planner的无响应闭环仿真程序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">conda activate nuplan</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> nuplan-devkit</span><br><span class="line"></span><br><span class="line">python nuplan/planning/script/run_simulation.py \</span><br><span class="line">+simulation=closed_loop_nonreactive_agents \</span><br><span class="line">planner=simple_planner \</span><br><span class="line">scenario_builder=nuplan_mini \</span><br><span class="line">scenario_filter=all_scenarios \</span><br><span class="line">scenario_filter.scenario_types=<span class="string">&quot;[near_multiple_vehicles, on_pickup_dropoff, starting_unprotected_cross_turn, high_magnitude_jerk]&quot;</span> \</span><br><span class="line">scenario_filter.num_scenarios_per_type=10</span><br></pre></td></tr></table></figure>

<p>在终端中输入如下指令，运行nuboard程序，跳转到浏览器：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python nuplan/planning/script/run_nuboard.py</span><br></pre></td></tr></table></figure>

<p>在浏览器中，点击<code>Upload file</code>，选择<code>~/nuplan/exp/exp/simulation/closed_loop_nonreactive_agents/xxxx</code>路径下的<code>nuboard_xxxx.nuboard</code>文件，在网页的Oerview界面中查看无响应闭环测评的结果：</p>
<p><img src="/307-2024-03-10-Math-AutoDriver/8.png" alt="8"></p>
<p>在网页的Scenarios界面中查看无响应闭环测评的场景信息（点击右上角设置图标选择场景）：</p>
<p><img src="/307-2024-03-10-Math-AutoDriver/9.png" alt="9"></p>
<h4 id="有响应闭环测评教程"><a href="#有响应闭环测评教程" class="headerlink" title="有响应闭环测评教程"></a>有响应闭环测评教程</h4><p>有响应闭环是指社会车辆对自车有响应，在终端中输入如下指令，运行simple_planner的有响应闭环仿真程序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">conda activate nuplan</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> nuplan-devkit</span><br><span class="line"></span><br><span class="line">python nuplan/planning/script/run_simulation.py \</span><br><span class="line">+simulation=closed_loop_reactive_agents \</span><br><span class="line">planner=simple_planner \</span><br><span class="line">scenario_builder=nuplan_mini \</span><br><span class="line">scenario_filter=all_scenarios \</span><br><span class="line">scenario_filter.scenario_types=<span class="string">&quot;[near_multiple_vehicles, on_pickup_dropoff, starting_unprotected_cross_turn, high_magnitude_jerk]&quot;</span> \</span><br><span class="line">scenario_filter.num_scenarios_per_type=10</span><br></pre></td></tr></table></figure>

<p>在终端中输入如下指令，运行nuboard程序，跳转到浏览器：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python nuplan/planning/script/run_nuboard.py</span><br></pre></td></tr></table></figure>

<p>在浏览器中，点击<code>Upload file</code>，选择<code>~/nuplan/exp/exp/simulation/closed_loop_reactive_agents/xxxx</code>路径下的<code>nuboard_xxxx.nuboard</code>文件，在网页的Oerview界面中查看有响应闭环测评的结果：</p>
<p><img src="/307-2024-03-10-Math-AutoDriver/10.png" alt="10"></p>
<p>在网页的Scenarios界面中查看有响应闭环测评的场景信息：</p>
<p><img src="/307-2024-03-10-Math-AutoDriver/11.png" alt="11"></p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p><code>cd nuplan-devkit/tutorial</code>然后打开<code>jupyte notebook</code>。双击进入其他框架。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Main tutorial for anyone who wants to dive right into ML planning. It describes how to 1) train an ML planner, 2) simulate it, 3) measure the performance and 4) visualize the results.</span></span><br><span class="line">nuplan_framework.ipynb</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tutorial with instructions on how to develop and simulate a planner from scratch within the nuPlan framework.</span></span><br><span class="line">nuplan_planner_tutorial.ipynb</span><br><span class="line"></span><br><span class="line"><span class="comment"># This notebook will cover the details involved in training a planning model in the NuPlan framework. This notebook is a more detailed deep dive into the NuPlan architecture, and covers the extensibility points that can be used to build customized models in the NuPlan framework.</span></span><br><span class="line">nuplan_advanced_model_training.ipynb</span><br></pre></td></tr></table></figure>

<h2 id="nuplan-devkit"><a href="#nuplan-devkit" class="headerlink" title="nuplan-devkit"></a>nuplan-devkit</h2><h3 id="EgoState类"><a href="#EgoState类" class="headerlink" title="EgoState类"></a>EgoState类</h3><p>路径：<code>./nuplan-devkit/nuplan/common/actor_state/ego_state.py</code></p>
<p><code>EgoState</code>类是自动驾驶系统中一个核心组件，代表自动驾驶车辆（即ego车辆）的当前状态，包括其位置、朝向、速度、加速度以及其他相关动态属性。以下是该类的主要特点和功能：</p>
<p><strong>主要属性和方法</strong></p>
<ul>
<li><strong>构造函数 (<code>__init__</code>)</strong>: 初始化<code>EgoState</code>实例时，需要传入以下参数：<ul>
<li><code>car_footprint</code>: <code>CarFootprint</code>对象，表示车辆的几何形状和朝向。</li>
<li><code>dynamic_car_state</code>: <code>DynamicCarState</code>对象，包含车辆的动态状态信息，如速度和加速度。</li>
<li><code>tire_steering_angle</code>: 车辆前轮的转向角度。</li>
<li><code>is_in_auto_mode</code>: 表示车辆是否处于自动驾驶模式。</li>
<li><code>time_point</code>: 时间戳，标识状态的时间点。</li>
</ul>
</li>
<li><strong>属性访问器</strong>:<ul>
<li><code>is_in_auto_mode</code>: 返回车辆是否处于自动驾驶模式。</li>
<li><code>car_footprint</code>: 获取车辆的几何足迹信息。</li>
<li><code>tire_steering_angle</code>: 获取车辆前轮的转向角度。</li>
<li><code>center</code>: 返回车辆的中心位置，使用<code>StateSE2</code>表示。</li>
<li><code>rear_axle</code>: 返回车辆后轴的位置和朝向，同样使用<code>StateSE2</code>表示。</li>
<li><code>time_point</code>, <code>time_us</code>, <code>time_seconds</code>: 提供对状态时间戳的访问。</li>
<li><code>dynamic_car_state</code>: 获取车辆的动态状态信息。</li>
<li><code>scene_object_metadata</code>: 返回与<code>EgoState</code>相关的场景对象元数据。</li>
<li><code>agent</code>: 将<code>EgoState</code>转换为<code>AgentState</code>对象，便于与环境中的其他代理进行交互。</li>
</ul>
</li>
<li><strong>类方法 (<code>build_from_rear_axle</code>, <code>build_from_center</code>)</strong>: 提供了基于车辆后轴或车辆中心的不同参数来初始化<code>EgoState</code>的能力。</li>
<li><strong>序列化和反序列化 (<code>serialize</code>, <code>deserialize</code>)</strong>: 支持将<code>EgoState</code>对象序列化为列表形式，以及从列表形式反序列化回<code>EgoState</code>对象，便于数据的存储和传输。</li>
<li><strong>动态状态 (<code>EgoStateDot</code>)</strong>: 一个从<code>EgoState</code>继承的子类，主要用于表达<code>EgoState</code>的动态变化，虽然在提供的代码片段中没有具体实现细节。</li>
</ul>
<h3 id="TimePoint类"><a href="#TimePoint类" class="headerlink" title="TimePoint类"></a>TimePoint类</h3><p><code>TimePoint</code>类是一个用于表示时间点的数据类，主要在时间序列或与时间相关的计算中使用。这个类提供了一种高精度的方式来表示和操作时间，特别是在需要处理与自动驾驶相关的事件和状态时。以下是<code>TimePoint</code>类的关键特点和功能：</p>
<p><strong>属性</strong></p>
<ul>
<li><strong><code>time_us</code></strong>: 时间点以微秒为单位，自纪元（Epoch，通常指1970年1月1日）以来的时间。</li>
</ul>
<p><strong>方法和功能</strong></p>
<ul>
<li><strong><code>__post_init__</code></strong>: 初始化后的验证方法，确保时间点是非负的。</li>
<li><strong>时间转换属性</strong>:<ul>
<li><strong><code>time_s</code></strong>: 将时间点从微秒转换为秒。</li>
</ul>
</li>
<li><strong>算术操作</strong>:<ul>
<li><strong><code>__add__</code>和<code>__radd__</code></strong>: 允许将<code>TimePoint</code>与<code>TimeDuration</code>相加，返回一个新的<code>TimePoint</code>对象，表示相加后的时间点。</li>
<li><strong><code>__sub__</code></strong>: 允许从<code>TimePoint</code>中减去一个<code>TimeDuration</code>或另一个<code>TimePoint</code>，返回一个新的<code>TimePoint</code>对象或<code>TimeDuration</code>对象，分别表示相减后的时间点或两个时间点之间的时间差。</li>
</ul>
</li>
<li><strong>比较操作</strong>:<ul>
<li><strong><code>__gt__</code></strong>, <strong><code>__ge__</code></strong>, <strong><code>__lt__</code></strong>, <strong><code>__le__</code></strong>, <strong><code>__eq__</code></strong>: 实现了大于、大于等于、小于、小于等于、等于操作，使得<code>TimePoint</code>对象可以直接进行时间比较。</li>
</ul>
</li>
<li><strong><code>__hash__</code></strong>: 提供了<code>TimePoint</code>对象的哈希方法，使其可以用作字典的键。</li>
<li><strong><code>diff</code></strong>: 计算与另一个<code>TimePoint</code>之间的时间差，返回一个<code>TimeDuration</code>对象，表示两个时间点之间的差异。</li>
</ul>
<h3 id="OrientedBox类"><a href="#OrientedBox类" class="headerlink" title="OrientedBox类"></a>OrientedBox类</h3><p><code>OrientedBox</code>类表示在平面上代理占据的物理空间。它通常用于自动驾驶系统中来表示车辆、行人等代理的几何形状和位置。以下是<code>OrientedBox</code>类的关键特性和方法：</p>
<p><strong>主要属性</strong></p>
<ul>
<li><strong><code>center</code></strong>: <code>StateSE2</code>对象，表示盒子几何中心的位置和朝向。这个属性包含了中心点的<code>(x, y)</code>坐标以及朝向角度（<code>heading</code>）。</li>
<li><strong><code>length</code></strong>: 盒子的长度（沿车辆行进方向）。</li>
<li><strong><code>width</code></strong>: 盒子的宽度（垂直于车辆行进方向）。</li>
<li><strong><code>height</code></strong>: 盒子的高度。</li>
</ul>
<p><strong>方法和功能</strong></p>
<ul>
<li><strong>构造函数 (<code>__init__</code>)</strong>: 接收中心位置、长度、宽度和高度作为参数，初始化<code>OrientedBox</code>实例。</li>
<li><strong><code>dimensions</code>属性</strong>: 返回盒子的尺寸，包括长度、宽度和高度。</li>
<li><strong><code>corner</code>方法</strong>: 根据传入的<code>OrientedBoxPointType</code>枚举值（例如，前左、前右、后左、后右、中心等），返回盒子上相应点的坐标。这个方法使用<code>translate_longitudinally_and_laterally</code>函数（假设存在）来计算指定点的位置。</li>
<li><strong><code>all_corners</code>方法</strong>: 返回一个包含盒子四个角（前左、后左、后右、前右）的坐标列表。</li>
<li><strong><code>geometry</code>属性</strong>: 返回描述<code>OrientedBox</code>的多边形（<code>Polygon</code>），如果还未构建，则懒加载地构建它。这对于执行几何运算，如碰撞检测等，非常有用。</li>
<li><strong><code>from_new_pose</code>类方法</strong>: 接收一个<code>OrientedBox</code>实例和一个新的<code>StateSE2</code>姿态，返回一个新的<code>OrientedBox</code>实例，其具有相同的尺寸但位于新的姿态。</li>
</ul>
<h3 id="StateVector2D类"><a href="#StateVector2D类" class="headerlink" title="StateVector2D类"></a>StateVector2D类</h3><p><code>StateVector2D</code>类代表一个二维向量，它是自动驾驶系统中用于表示位置、速度、加速度等向量属性的基础类。这个类提供了对二维向量操作的基本方法和属性。以下是<code>StateVector2D</code>类的关键特性和功能：</p>
<p><strong>属性</strong></p>
<ul>
<li><strong><code>_x</code>和<code>_y</code></strong>: 分别代表向量在x轴和y轴上的分量。</li>
<li><strong><code>_array</code></strong>: 一个<code>numpy</code>数组，包含向量的<code>(x, y)</code>分量。这为向量的数学运算和处理提供了便利。</li>
</ul>
<p><strong>方法和功能</strong></p>
<ul>
<li><strong>构造函数 (<code>__init__</code>)</strong>: 接收两个浮点数<code>x</code>和<code>y</code>作为参数，初始化<code>StateVector2D</code>实例。</li>
<li><strong><code>__repr__</code></strong>: 返回类的字符串表示，便于调试和打印。</li>
<li><strong><code>__eq__</code></strong>: 重载等于运算符，用于比较两个<code>StateVector2D</code>实例是否相等。</li>
<li><strong>属性访问器和设置器</strong>:<ul>
<li><strong><code>array</code></strong>: 以<code>numpy</code>数组形式返回向量的<code>(x, y)</code>分量，并允许设置新的数组值。</li>
<li><strong><code>x</code>和<code>y</code></strong>: 分别访问和设置向量的x轴和y轴分量。</li>
</ul>
</li>
<li><strong><code>magnitude</code></strong>: 计算并返回向量的大小（长度）。</li>
</ul>
<h3 id="ReferenceLineProvider类"><a href="#ReferenceLineProvider类" class="headerlink" title="ReferenceLineProvider类"></a>ReferenceLineProvider类</h3><p>路径：<code>/nuplan-devkit/nuplan/planning/simulation/planner/project2/reference_line_provider.py</code></p>
<p><code>ReferenceLineProvider</code>类负责生成和管理参考线，这在自动驾驶规划和导航中是一个关键的概念。参考线通常用于指导自动驾驶车辆的路径规划，表示道路的中心线或车辆的预期行驶路径。这个类通过与<code>BFSRouter</code>（一个假设的路由器类）的交互，从提供的路径中生成参考线。以下是<code>ReferenceLineProvider</code>类的主要特性和方法：</p>
<p><strong>属性</strong></p>
<ul>
<li><strong>路径属性</strong>：从<code>BFSRouter</code>接收的路径信息，包括离散路径点(<code>_discrete_path</code>)、路径的左边界(<code>_lb_of_path</code>)、右边界(<code>_rb_of_path</code>)、路径的累计长度(<code>_s_of_path</code>)和路径上每个点的最大速度(<code>_max_v_of_path</code>)。</li>
<li><strong>参考线信息</strong>：生成的参考线的各种属性，如左右边界(<code>_lb_of_reference_line</code>和<code>_rb_of_reference_line</code>)、最大速度(<code>_max_v_of_reference_line</code>)、参考线上的点的累计长度(<code>_s_of_reference_line</code>)、坐标(<code>_x_of_reference_line</code>和<code>_y_of_reference_line</code>)、朝向(<code>_heading_of_reference_line</code>)和曲率(<code>_kappa_of_reference_line</code>)。</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li>**<code>_reference_line_generate</code>**：该方法接收一个<code>EgoState</code>实例作为输入，并根据车辆当前状态生成参考线。它通过寻找路径上最接近自动驾驶车辆的点，然后在该点的前后进行采样，生成参考线。</li>
<li>**<code>cal_point_in_line</code>**：计算直线上给定x坐标处的y值。这个方法在生成参考线的过程中被用来插值。</li>
<li>**<code>calculate_heading</code>**：计算参考线上各点的朝向。这对于确保自动驾驶车辆沿着正确的方向行驶至关重要。</li>
<li>**<code>calculate_kappa</code>**：计算参考线的曲率。曲率的计算对于理解道路的弯曲程度和规划相应的转向策略很重要。</li>
<li>**<code>get_boundary</code>**：根据给定的一组累积长度(<code>s_set</code>)，返回对应的左右边界值。这个方法对于判断车辆是否偏离预期路径有帮助。</li>
</ul>
<h1 id="基于模型的预测方法"><a href="#基于模型的预测方法" class="headerlink" title="基于模型的预测方法"></a>基于模型的预测方法</h1><p>其实包含基本的基于模型的预测方法，还有一些基于learning的预测方法</p>
<p><img src="/./307-2024-03-10-Math-AutoDriver/12.png" alt="12"></p>
<h2 id="定速度预测"><a href="#定速度预测" class="headerlink" title="定速度预测"></a>定速度预测</h2><p><strong>一维匀速运动模型</strong></p>
<p> 目标做匀速直线运动，加速度为0。</p>
<p>现实中速度会有轻微扰动，可视为具有高斯分布的噪声。<br>$$<br>\ddot{X}(t)&#x3D;W(t)<br>$$<br>一维状态向量<br>$$<br>X&#x3D;[x, \dot{x}]^{T}<br>$$<br>一维连续Constant Velocity模型：<br>$$<br>\dot{X}\left(t\right)&#x3D;\begin{bmatrix}0&amp;1\0&amp;0\end{bmatrix}X(t)+\begin{bmatrix}0\1\end{bmatrix}W(t)<br>$$<br>常用离散形式：<br>$$<br>X_{k+1}&#x3D;\begin{bmatrix}1&amp;&amp;\text{T}\0&amp;&amp;1\end{bmatrix}X_k+\begin{bmatrix}\text{T}^2&#x2F;2\\text{T}\end{bmatrix}W_k<br>$$<br>其中$T$是采样时间。</p>
<p><strong>二维匀速运动模型</strong></p>
<p>二维状态向量：<br>$$<br>X&#x3D;[x,\dot{x},\quad y,\dot{y}]^{\mathrm{T}}<br>$$<br>二维连续Constant Velocity模型：<br>$$<br>\dot{X}(t)&#x3D;\begin{bmatrix}0&amp;1&amp;0&amp;0\0&amp;0&amp;0&amp;0\0&amp;0&amp;0&amp;1\0&amp;0&amp;0&amp;0\end{bmatrix}X(t)+\begin{bmatrix}0&amp;0\1&amp;0\0&amp;0\0&amp;1\end{bmatrix}W(t)<br>$$<br>二维离散Constant Velocity模型：<br>$$<br>X_{k+1}&#x3D;\begin{bmatrix}1&amp;&amp;\text{T}&amp;&amp;0&amp;&amp;0\0&amp;&amp;1&amp;&amp;0&amp;&amp;0\0&amp;&amp;0&amp;&amp;1&amp;&amp;\text{T}\0&amp;&amp;0&amp;&amp;0&amp;&amp;1\end{bmatrix}X_k+\begin{bmatrix}\text{T}^2&#x2F;2&amp;&amp;0\\text{T}&amp;&amp;0\0&amp;&amp;\text{T}^2&#x2F;2\0&amp;&amp;\text{T}\end{bmatrix}W_k<br>$$<br>其中$T$是采样时间。</p>
<h2 id="定曲率预测"><a href="#定曲率预测" class="headerlink" title="定曲率预测"></a>定曲率预测</h2><p>匀速圆周运动状态向量(转弯角速度已知)：<br>$$<br>X&#x3D;[x,\dot{x},\quad y,\dot{y}]^{\mathrm{T}}<br>$$<br>匀速圆周运动离散模型：转角变化率$\delta$恒定<br>$$<br>X_{k+1}&#x3D;\left[\begin{array}{cccc}<br>1 &amp; 0 &amp; 0 &amp; 0 \<br>0 &amp; 1 &amp; 0 &amp; 0 \<br>0 &amp; 0 &amp; 1 &amp; 0 \<br>0 &amp; 0 &amp; 0 &amp; 1<br>\end{array}\right] X_{k}+\left[\begin{array}{c}<br>\mathrm{T} * v * \cos \left(\omega_{\mathrm{k}}\right) \<br>0 \<br>\mathrm{<del>T} * v * \sin \left(\omega_{\mathrm{k}}\right) \<br>0<br>\end{array}\right]+\left[\begin{array}{cc}<br>\mathrm{T}^{2} &#x2F; 2 &amp; 0 \<br>\mathrm{</del>T} &amp; 0 \<br>0 &amp; \mathrm{<del>T}^{2} &#x2F; 2 \<br>0 &amp; \mathrm{</del>T}<br>\end{array}\right] W_{k}<br>$$</p>
<table>
<thead>
<tr>
<th>定速度预测</th>
<th>定曲率预测</th>
</tr>
</thead>
<tbody><tr>
<td>适用于速度变化不大的场景</td>
<td>适用于曲线路径,汽车转弯的情况</td>
</tr>
<tr>
<td>预测精度不高</td>
<td>预测精度稍高</td>
</tr>
<tr>
<td>在速度或方向发生显著变化时失准</td>
<td>在直线运动或曲率变化大时失准</td>
</tr>
</tbody></table>
<p>短期预测：基于运动学模型或者预测网络,完成短时推演,一般为3s</p>
<p>长期预测：结合意图预测,稳定长时预测,避免远端发散,一般为8s+</p>
<h2 id="基于手工特征的意图预测"><a href="#基于手工特征的意图预测" class="headerlink" title="基于手工特征的意图预测"></a>基于手工特征的意图预测</h2><h3 id="基于SVM的意图分类"><a href="#基于SVM的意图分类" class="headerlink" title="基于SVM的意图分类"></a>基于SVM的意图分类</h3><h3 id="基于神经网络的意图预测"><a href="#基于神经网络的意图预测" class="headerlink" title="基于神经网络的意图预测"></a>基于神经网络的意图预测</h3><p>基于模型的轨迹预测</p>
<table>
<thead>
<tr>
<th>曲线类型</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>贝塞尔曲线</td>
<td>可以通过少量的控制点来描述曲线，难以修改，而且计算简单</td>
<td>难以修改，一个控制点的变化会影响整条曲线</td>
</tr>
<tr>
<td>B样条曲线</td>
<td>具有局部性和一定程度的平滑性，可以自定义阶次，移动控制点仅仅改变曲线的部分形状</td>
<td>在复杂情况下计算难度大，对于拥有很多控制点的复杂曲线，B样条曲线需要更高阶的多项式，合并两条曲线也比较困难</td>
</tr>
<tr>
<td>卡尔曼滤波</td>
<td>可以处理非线性系统，同时可以处理多维度的数据</td>
<td>需要对系统建立数学模型，而且对于非线性系统，需要使用扩展卡尔曼滤波等变种算法</td>
</tr>
</tbody></table>
<h1 id="相关知识"><a href="#相关知识" class="headerlink" title="相关知识"></a>相关知识</h1><h2 id="自动驾驶中的车辆运动学模型"><a href="#自动驾驶中的车辆运动学模型" class="headerlink" title="自动驾驶中的车辆运动学模型"></a>自动驾驶中的车辆运动学模型</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/103834150">参考链接</a></p>
</blockquote>
<h3 id="以后轴为原点的车辆运动学模型"><a href="#以后轴为原点的车辆运动学模型" class="headerlink" title="以后轴为原点的车辆运动学模型"></a>以后轴为原点的车辆运动学模型</h3><h1 id=""><a href="#" class="headerlink" title=""></a><img src="/308-2024-03-20-Math-AutoDriver/1.png" alt="1"></h1><p><img src="/./307-2024-03-10-Math-AutoDriver/13.png" alt="13"></p>
<p><strong>参数</strong><br>$(x, y, \theta)$：车辆状态信息，分别为坐标位置以及朝向</p>
<p>$b$：车身长度</p>
<p>$\phi$：车轮转向角</p>
<p>$r$：车轮转向角为$\phi$时的半径</p>
<p><strong>推导</strong></p>
<p>求$\dot{x}, \dot{y}, \dot{\theta}$分别为横向速度、纵向速度、角速度</p>
<p>令$s$表示车辆的速度，$\omega$为车辆位移</p>
<p>1. </p>
<p>有<br>$$<br>\begin{aligned}<br>\frac{\mathrm{d} y}{\mathrm{d} x} &amp;&#x3D; \tan{\theta} \<br>\frac{\mathrm{d} y}{\mathrm{d} x} &amp;&#x3D; \frac{\dot{y}}{\dot{x}} \<br>\tan{\theta} &amp;&#x3D; \frac{\sin{\theta}}{\cos{\theta}}<br>\end{aligned}<br>$$</p>
<p>可得<br>$$<br>-\dot{x}\sin{\theta}+\dot{y}\cos{\theta}&#x3D;0<br>$$</p>
<p>2. </p>
<p>车辆短时位移<br>$$<br>\mathrm{d} \omega&#x3D;r \mathrm{d} \theta<br>$$<br>且<br>$$<br>r &#x3D; \frac{b}{\tan{\phi}}<br>$$<br>所以有<br>$$<br>\mathrm{d} \omega&#x3D;\frac{b}{\tan{\phi}} \mathrm{d} \theta<br>$$<br>两边同时除以$\mathrm{d} t$，且有<br>$$<br>\dot{\omega} &#x3D; s<br>$$<br>可得<br>$$<br>\dot{\theta} &#x3D; \frac{s}{b} \tan{\phi}<br>$$</p>
<p>3. </p>
<p>综上<br>$$<br>\left[\begin{array}{c}<br>\dot{x} \<br>\dot{y} \<br>\dot{\theta}<br>\end{array}\right]&#x3D;s *\left[\begin{array}{c}<br>\cos (\theta) \<br>\sin (\theta) \<br>\frac{\tan \phi}{b}<br>\end{array}\right]<br>$$</p>
<p>$$<br>\dot{s} &#x3D; a<br>$$</p>
<h2 id="卡尔曼滤波"><a href="#卡尔曼滤波" class="headerlink" title="卡尔曼滤波"></a>卡尔曼滤波</h2><p>卡尔曼滤波是一种利用线性系统状态方程，通过系统输入输出观测数据，对系统状态进行最优估计的算法。由于观测数据中包括系统中的噪声和干扰的影响，所以最优估计也可看作是滤波过程。</p>
<h2 id="支持向量机"><a href="#支持向量机" class="headerlink" title="支持向量机"></a>支持向量机</h2><p>支持向量机（support vector machines, SVM）是一种二分类模型，它的基本模型是定义在特征空间上的<strong>间隔最大的线性分类器</strong>，间隔最大使它有别于感知机；SVM还包括<strong>核技巧</strong>，这使它成为实质上的非线性分类器。SVM的的学习策略就是间隔最大化，可形式化为一个求解凸二次规划的问题，也等价于正则化的合页损失函数的最小化问题。SVM的的学习算法就是求解凸二次规划的最优化算法。</p>
<p>SVM学习的基本想法是求解能够正确划分训练数据集并且几何间隔最大的分离超平面。如下图所示， 即为分离超平面，对于线性可分的数据集来说，这样的超平面有无穷多个（即感知机)，但是几何间隔最大的分离超平面却是唯一的。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">Arvin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/03/10/307-2024-03-10-Math-AutoDriver/">http://example.com/2024/03/10/307-2024-03-10-Math-AutoDriver/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/nacho.jepg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/03/20/308-2024-03-20-Math-AutoDriver/" title="自动驾驶预测与决策规划（二）"><div class="cover" style="background: None"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">自动驾驶预测与决策规划（二）</div></div><div class="info-2"><div class="info-item-1">文档维护：Arvin 网页部署：Arvin ▶ 写在前面：本文内容是作者在深蓝学院自动驾驶预测与决策规划学习时的笔记，作者按照自己的理解进行了记录，如果有错误的地方还请执政。如涉侵权，请联系删除。 规划算法（笔记）路径与轨迹规划（笔记）基于搜索的路径规划Hybrid A*算法 节点的拓展基于车辆运动学模型 代价的计算基于栅格栏  代价计算 代价包括节点遍历代价和两个启发函数，即$F(n)&#x3D;g(n)+h_1(n)+h_2(n)$，其中  $g(n)$主要考虑路径长度、运动学约束、方向变换成本; $h_1(n)$只考虑车辆的运动学约束而不考虑障碍物; $h_2(n)$只考虑障碍物信息而不考虑车辆的运动学约束;  基于采样的路径规划Frenet坐标系 Werling M , Ziegler J , Kammel S , et al. Optimal Trajectory Generation for Dynamic Street Scenarios in a Frenet Frame[C]&#x2F;&#x2F; Robotics and Automation (ICRA),...</div></div></div></a><a class="pagination-related" href="/2024/03/02/306-2024-03-02-Math-Optimization/" title="机器人中的数值优化（五）"><div class="cover" style="background: None"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">机器人中的数值优化（五）</div></div><div class="info-2"><div class="info-item-1">文档维护：Arvin 网页部署：Arvin ▶ 写在前面：本文内容是作者在深蓝学院机器人中的数值优化学习时的笔记，作者按照自己的理解进行了记录，如果有错误的地方还请执政。如涉侵权，请联系删除。 附录(笔记)函数的光滑技巧Inf convolution卷积Inf convolution 卷积操作适应于凸函数，Inf convolution 卷积操作的目标是把不光滑的凸函数进行光滑近似，并使得光滑近似后的函数于原函数尽量吻合。      对于两个凸函数$f_1， f_2$，它们之间的Inf convolution 卷积操作记为$f_1\Box f_2$，即找一个$u_1$和$u_2$，满足$u_1+u_2&#x3D;x$的条件下，使得$f_1(u_1)+f_2(u_2)$最大或最小，如下面的第一个表达式所示，由于满足$u_1+u_2&#x3D;x$，因此可消去一个$u$进行简化，简化后的表达式如下面第二个式子所示：$$\begin{aligned}(f_1\Box f_2)(x)&amp;&#x3D;\inf_{(u_1,u_2)\in\mathbb{R}^d\times\mathb...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/nacho.jepg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Arvin</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6%E5%86%B3%E7%AD%96%E8%A7%84%E5%88%92%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">自动驾驶决策规划简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">实验准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDnuplan-devkit"><span class="toc-number">1.1.1.</span> <span class="toc-text">下载nuplan-devkit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85miniconda"><span class="toc-number">1.1.2.</span> <span class="toc-text">安装miniconda</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#conda%E6%8D%A2%E6%BA%90"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">conda换源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAconda%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">创建conda环境</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nuplan-devkit"><span class="toc-number">1.1.3.</span> <span class="toc-text">安装nuplan-devkit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDnuplan%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.1.4.</span> <span class="toc-text">下载nuplan数据集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.5.</span> <span class="toc-text">环境变量配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">软件包环境变量配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">数据库环境变量配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%95%88%E6%9E%9C"><span class="toc-number">1.1.6.</span> <span class="toc-text">实验效果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E5%8F%AF%E8%A7%86%E5%8C%96%E6%95%99%E7%A8%8B"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">场景可视化教程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E7%8E%AF%E6%B5%8B%E8%AF%84%E6%95%99%E7%A8%8B"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">开环测评教程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%93%8D%E5%BA%94%E9%97%AD%E7%8E%AF%E6%B5%8B%E8%AF%84%E6%95%99%E7%A8%8B"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">无响应闭环测评教程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%93%8D%E5%BA%94%E9%97%AD%E7%8E%AF%E6%B5%8B%E8%AF%84%E6%95%99%E7%A8%8B"><span class="toc-number">1.1.6.4.</span> <span class="toc-text">有响应闭环测评教程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.1.6.5.</span> <span class="toc-text">其他</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nuplan-devkit"><span class="toc-number">1.2.</span> <span class="toc-text">nuplan-devkit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EgoState%E7%B1%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text">EgoState类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TimePoint%E7%B1%BB"><span class="toc-number">1.2.2.</span> <span class="toc-text">TimePoint类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OrientedBox%E7%B1%BB"><span class="toc-number">1.2.3.</span> <span class="toc-text">OrientedBox类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#StateVector2D%E7%B1%BB"><span class="toc-number">1.2.4.</span> <span class="toc-text">StateVector2D类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReferenceLineProvider%E7%B1%BB"><span class="toc-number">1.2.5.</span> <span class="toc-text">ReferenceLineProvider类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%A2%84%E6%B5%8B%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">基于模型的预测方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E9%80%9F%E5%BA%A6%E9%A2%84%E6%B5%8B"><span class="toc-number">2.1.</span> <span class="toc-text">定速度预测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%9B%B2%E7%8E%87%E9%A2%84%E6%B5%8B"><span class="toc-number">2.2.</span> <span class="toc-text">定曲率预测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%89%8B%E5%B7%A5%E7%89%B9%E5%BE%81%E7%9A%84%E6%84%8F%E5%9B%BE%E9%A2%84%E6%B5%8B"><span class="toc-number">2.3.</span> <span class="toc-text">基于手工特征的意图预测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8ESVM%E7%9A%84%E6%84%8F%E5%9B%BE%E5%88%86%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">基于SVM的意图分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%9A%84%E6%84%8F%E5%9B%BE%E9%A2%84%E6%B5%8B"><span class="toc-number">2.3.2.</span> <span class="toc-text">基于神经网络的意图预测</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="toc-number">3.</span> <span class="toc-text">相关知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6%E4%B8%AD%E7%9A%84%E8%BD%A6%E8%BE%86%E8%BF%90%E5%8A%A8%E5%AD%A6%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.1.</span> <span class="toc-text">自动驾驶中的车辆运动学模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%90%8E%E8%BD%B4%E4%B8%BA%E5%8E%9F%E7%82%B9%E7%9A%84%E8%BD%A6%E8%BE%86%E8%BF%90%E5%8A%A8%E5%AD%A6%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">以后轴为原点的车辆运动学模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2"><span class="toc-number">4.1.</span> <span class="toc-text">卡尔曼滤波</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA"><span class="toc-number">4.2.</span> <span class="toc-text">支持向量机</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/18/hello-world/" title="Hello World">Hello World</a><time datetime="2025-08-18T07:15:49.592Z" title="Created 2025-08-18 15:15:49">2025-08-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/18/503-2025-08-18-Others-HexoBlog/" title="HEXO个人博客搭建">HEXO个人博客搭建</a><time datetime="2025-08-17T16:00:00.000Z" title="Created 2025-08-18 00:00:00">2025-08-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/09/502-2024-11-09-Others-Ubuntu/" title="系统安装">系统安装</a><time datetime="2024-11-08T16:00:00.000Z" title="Created 2024-11-09 00:00:00">2024-11-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/08/309-2024-04-08-Math-AutoDriver/" title="自动驾驶预测与决策规划（三）">自动驾驶预测与决策规划（三）</a><time datetime="2024-04-07T16:00:00.000Z" title="Created 2024-04-08 00:00:00">2024-04-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/20/308-2024-03-20-Math-AutoDriver/" title="自动驾驶预测与决策规划（二）">自动驾驶预测与决策规划（二）</a><time datetime="2024-03-19T16:00:00.000Z" title="Created 2024-03-20 00:00:00">2024-03-20</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Arvin</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>